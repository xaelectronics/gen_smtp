%% -*- mode: erlang; -*-
{require_min_otp_vsn, "R16"}.

{erl_opts, [fail_on_warning,
           debug_info,
           warn_unused_vars,
           warn_unused_import,
           warn_exported_vars,
           {platform_define, "^((1[89])|2)", deprecated_now}]}.


{profiles, 
 [
  {test, 
   [
    {cover_enabled, true},
    {cover_print_enabled, true},
    {deps, 
     [
      {iconv, ".*", {git, "git://github.com/processone/iconv.git", {branch, "master"}}}
     ]
    },

    {overrides,
     [{override, iconv,
       [
        {plugins, [pc]},
        {port_env, [{"darwin|freebsd|openbsd", "LDFLAGS", "$LDFLAGS -liconv"},
                    {"freebsd|openbsd", "CFLAGS", "$CFLAGS -I/usr/local/include"},
                    {"freebsd|openbsd", "LDFLAGS", "$LDFLAGS -L/usr/local/lib"}]},

        {port_specs, [{"priv/iconv_nif.so", ["c_src/*.c"]}]},
        {artifacts, ["priv/iconv_nif.so"]},

        {provider_hooks, [
                          {post,
                           [
                            {compile, {pc, compile}},
                            {clean, {pc, clean}}
                           ]
                          }]
        }
       ]}
     ]}
   ]}
 ]}.
